import webbrowser
import os
import time
import playsound
import speech_recognition as sr
from gtts import gTTS
import random
import word_count
import subprocess
import wikipedia
import datetime

r = sr.Recognizer()

lang = 'eng'

def speak(text):
    tts = gTTS(text=text, lang="en")
    r = random.randint(1, 1000000000)
    filename = 'assistant' +str(r) + '.mp3'
    tts.save(filename)
    playsound.playsound(filename)
    os.remove(filename)

def get_audio(ask = False):
    r = sr.Recognizer()
    if ask:
          speak(ask)
    with sr.Microphone() as source:
        audio = r.listen(source)
        said = ""

        try:
            said = r.recognize_google(audio)
            print(said)
        except sr.UnknownValueError:
            print('')
        except sr.RequestError:
            print('Sorry I could not process because of your current internet problem')

    return said.lower()

def note(text):
    date = datetime.datetime.now()
    file_name = str(date).replace(":", "-") + "note.txt"
    with open(file_name, "w") as f:
        f.write(text)

    subprocess.Popen(["notepad.exe", file_name])

song = "payphone"
speak("1 second")
driver.get("https://www.youtube.com/results?search_query=" + song)
delay = 3
myElem = WebDriverWait(driver, delay).until(EC.presence_of_element_located((By.ID, 'video-title')))
driver.find_element_by_css_selector("a[id='video-title']").click()
speak("Playing " + song)

TIME_STRS = ["what is the time", "show me the time", "open time", "time"]
YR_STRS = ["what year is it", "what year are we in", "what is the year", "what is the present year"]
NOTE_STRS = ["make a note", "save this", "make note of this", "generate a note"]
MAPS_STRS = ["open maps", "google maps", "show me maps", "show me google maps", "maps"]
SEARCH_STRS = ["open search", "search", "open search engine", "search something", "make a search"]
NAME_STRS = ["hello what is your name", "what is your name", "your name", "may I know your name", "name"]
WIKI_STRS = ["open wiki", "open wikipedia", "show wiki", "show wikipedia", "open up wikipedia", "open up wiki", "search wikipedia", "search wiki", "search something on wiki", "search something on wikipedia"]
HELLO_STRS = ["hi", "hello", "hello there", "hi there", "hi hello"]
YOUTUBE_STRS = ["open youtube", "search youtube", "look in youtube", "open up youtube"]
WEATHER_STRS = ["show me the local weather", "what is the weather", "open up the weather", "weather"]
SONGYT = ["play song", "play song on youtube", "play"]
WAKE = "friday"

while True:
    print("Waiting...")
    text = get_audio()

    if text.count(WAKE) > 0:
        speak("Hello, how may I help you")
        text = get_audio()

        for phrase in HELLO_STRS:
            if phrase in text:
                speak("Hello")

        for phrase in NAME_STRS:
            if phrase in text:
                speak("Hello there, my name is FRIDAY")

        for phrase in SEARCH_STRS:
            if phrase in text:
                search = get_audio('What would you like to search for?')
                url = 'https://www.google.com/search?q=' + search
                webbrowser.get().open(url)
                speak('Here is what I found for "' + search + '"')
                asking = get_audio('Is this what you were looking  for?')

        for phrase in MAPS_STRS:
            if phrase in text:
                place = get_audio('Where would you like to search for?')
                url = 'https://www.google.com/maps/place/' + place
                webbrowser.get().open(url)
                speak('Here is what I found for "' + place + '"')

        for phrase in WIKI_STRS:
            if phrase in text:
                thing = get_audio('What definition  would you like to search for?')
                url = 'https://en.wikipedia.org/wiki/' + thing
                webbrowser.get().open(url)
                speak('Here is what I found for "' + thing + '"')
                wikipedia.set_lang("en")
                data = wikipedia.summary("'" + thing + "'", 2)
                speak(data)

        for phrase in YOUTUBE_STRS:
            if phrase in text:
                tube_search = get_audio('What would you like to search for?')
                url = 'https://www.youtube.com/results?search_query=' + tube_search
                webbrowser.get().open(url)
                speak('Here is what I found for "' + tube_search + '"')

        for phrase in WEATHER_STRS:
            if phrase in text:
                url = 'https://www.msn.com/en-gb/weather/today/weather-today/we-city?el=PtQcTqcpueQvkK4zN%2BaZDg%3D%3D&ocid=ansmsnweather'
                webbrowser.get().open(url)
                speak('Here is what I found for your local weather')

        for phrase in NOTE_STRS:
            if phrase in text:
                speak("What would you like me to take a note of")
                note_text = get_audio().lower()
                note(note_text)
                speak("I have made a note of that")

        for phrase in TIME_STRS:
            if phrase in text:
                strTime = datetime.datetime.now(utc).strftime("%H:%M:%S")
                speak(f"the time is {strTime}")

        for phrase in SONGYT_STRS:
            if phrase in text:
                song_search = get_audio('What song would you like me to play?')
                pywhatkit.playonyt("'" + song_search + "'")
